var Pryv=function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e,r){var n=/(.+):\/\/(.+)@(.+)/gm,i=/(.+):\/\/(.+)/gm,s={superagent:r(8),isBrowser:function(){return"undefined"!=typeof window},extractTokenAndApiEndpoint:function(t){n.lastIndex=0;var e=n.exec(t);if(null!==e)return e[3].endsWith("/")||(e[3]+="/"),{endpoint:e[1]+"://"+e[3],token:e[2]};i.lastIndex=0;var r=i.exec(t);if(null===r)throw new Error("Cannot find endpoint, invalid URL format");return r[2].endsWith("/")||(r[2]+="/"),{endpoint:r[1]+"://"+r[2],token:null}},buildPryvApiEndpoint:function(t){if(!t.token){var e=t.endpoint+"";return t.endpoint.endsWith("/")||(e+="/"),e}i.lastIndex=0;var r=i.exec(t.endpoint);return r[2].endsWith("/")||(r[2]+="/"),r[1]+"://"+t.token+"@"+r[2]},extractUsernameFromAPIAndEndpoint:function(t,e){var r=s.extractTokenAndApiEndpoint(e).endpoint,n=t.indexOf("{username}"),i=t.length-n-10;if(n<5)throw new Error("Invalid API schema with no {username} placeholder");var o=r.slice(n,-i);if(t.replace("{username}",o)!==r)throw new Error("serviceInfoApi "+t+" schema does not match apiEndpoint: "+e);return o}};t.exports=s},function(t,e,r){function n(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(i,s){var o=t.apply(e,r);function a(t){n(o,i,s,a,u,"next",t)}function u(t){n(o,i,s,a,u,"throw",t)}a(void 0)}))}}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=r(0),a=r(15),u=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._pryvServiceInfo=null,this._assets=null,this._pryvServiceInfoUrl=e,this._pryvServiceCustomizations=r}var e,r,n,u,p,h,l;return e=t,r=[{key:"info",value:(l=i(regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e&&this._pryvServiceInfo){t.next=9;break}if(r={},!this._pryvServiceInfoUrl){t.next=7;break}return t.next=5,o.superagent.get(this._pryvServiceInfoUrl).set("Access-Control-Allow-Origin","*").set("accept","json");case 5:n=t.sent,r=n.body;case 7:Object.assign(r,this._pryvServiceCustomizations),this.setServiceInfo(r);case 9:return t.abrupt("return",this._pryvServiceInfo);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return l.apply(this,arguments)})},{key:"setServiceInfo",value:function(t){if(!t.name)throw new Error("Invalid data from service/info");["access","api","register"].forEach((function(e){"/"!==t[e].slice(-1)&&(t[e]+="/")})),this._pryvServiceInfo=t}},{key:"assets",value:(h=i(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e||!this._assets){t.next=4;break}return t.abrupt("return",this._assets);case 4:return t.next=6,this.info();case 6:if((r=t.sent).assets&&r.assets.definitions){t.next=10;break}return console.log("Warning: no assets for this service"),t.abrupt("return",null);case 10:return t.next=12,a.setup(r.assets.definitions);case 12:return this._assets=t.sent,t.abrupt("return",this._assets);case 14:case"end":return t.stop()}}),t,this)}))),function(t){return h.apply(this,arguments)})},{key:"infoSync",value:function(){return this._pryvServiceInfo}},{key:"apiEndpointFor",value:(p=i(regeneratorRuntime.mark((function e(r,n){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.info();case 2:return i=e.sent,e.abrupt("return",t.buildAPIEndpoint(i,r,n));case 4:case"end":return e.stop()}}),e,this)}))),function(t,e){return p.apply(this,arguments)})},{key:"login",value:(u=i(regeneratorRuntime.mark((function e(r,n,i,s){var a,u,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiEndpointFor(r);case 2:if(a=e.sent,e.prev=3,u={accept:"json"},e.t0=s,e.t0){e.next=10;break}return e.next=9,this.info();case 9:e.t0=e.sent.register;case 10:return s=e.t0,o.isBrowser()||(u.Origin=s),e.next=14,o.superagent.post(a+"auth/login").set(u).send({username:r,password:n,appId:i});case 14:if((p=e.sent).body.token){e.next=17;break}throw new Error("Invalid login response: "+p.body);case 17:return e.t1=c,e.t2=t,e.next=21,this.info();case 21:return e.t3=e.sent,e.t4=r,e.t5=p.body.token,e.t6=e.t2.buildAPIEndpoint.call(e.t2,e.t3,e.t4,e.t5),e.t7=this,e.abrupt("return",new e.t1(e.t6,e.t7));case 29:if(e.prev=29,e.t8=e.catch(3),!(e.t8.response&&e.t8.response.body&&e.t8.response.body.error&&e.t8.response.body.error.message)){e.next=33;break}throw new Error(e.t8.response.body.error.message);case 33:case"end":return e.stop()}}),e,this,[[3,29]])}))),function(t,e,r,n){return u.apply(this,arguments)})}],n=[{key:"buildAPIEndpoint",value:function(t,e,r){var n=t.api.replace("{username}",e);return o.buildPryvApiEndpoint({endpoint:n,token:r})}}],r&&s(e.prototype,r),n&&s(e,n),t}();t.exports=u;var c=r(4)},function(t,e){t.exports={ERROR:"error",LOADING:"loading",INITIALIZED:"initialized",AUTHORIZED:"authorized",LOGOUT:"logout"}},function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t.exports=function(t){return null!==t&&"object"===n(t)}},function(t,e,r){function n(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(i,s){var o=t.apply(e,r);function a(t){n(o,i,s,a,u,"next",t)}function u(t){n(o,i,s,a,u,"throw",t)}a(void 0)}))}}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=r(0),a=r(16),u=r(17),c=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=o.extractTokenAndApiEndpoint(e),i=n.token,s=n.endpoint;if(this.token=i,this.endpoint=s,this.options={},this.options.chunkSize=1e3,this._deltaTime={value:0,weight:0},!r instanceof p)throw new Error("Invalid service param");this._service=r}var e,r,n,c,h,l,f,d,y,v,m,g,b;return e=t,(r=[{key:"username",value:(b=i(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.service.info();case 2:return e=t.sent,t.abrupt("return",o.extractUsernameFromAPIAndEndpoint(e.api,this.endpoint));case 4:case"end":return t.stop()}}),t,this)}))),function(){return b.apply(this,arguments)})},{key:"api",value:(g=i(regeneratorRuntime.mark((function t(e,r){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=function(t){return this.post("",t)},t.next=4,this._chunkedBatchCall(e,r,n.bind(this));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return g.apply(this,arguments)})},{key:"_chunkedBatchCall",value:(m=i(regeneratorRuntime.mark((function t(e,r,n){var i,s,o,a,u,c,p,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)){t.next=2;break}throw new Error("Pryv.api() takes an array as input");case 2:i=[],s=0,o=0;case 5:if(!(e.length>=o)){t.next=30;break}for(a=[],u=Math.min(o+this.options.chunkSize,e.length),c=o;c<u;c++)a.push({method:e[c].method,params:e[c].params});return t.next=11,n(a);case 11:if((p=t.sent)&&Array.isArray(p.results)){t.next=14;break}throw new Error("API call result is not an Array: "+JSON.stringify(p));case 14:if(p.results.length==a.length){t.next=16;break}throw new Error("API call result Array does not match request: "+JSON.stringify(p));case 16:h=0;case 17:if(!(h<p.results.length)){t.next=24;break}if(!e[h+o].handleResult){t.next=21;break}return t.next=21,e[h+o].handleResult.call(null,p.results[h]);case 21:h++,t.next=17;break;case 24:Array.prototype.push.apply(i,p.results),s=Math.round(100*i.length/e.length),r&&r(s,i);case 27:o+=this.options.chunkSize,t.next=5;break;case 30:return t.abrupt("return",i);case 31:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return m.apply(this,arguments)})},{key:"post",value:(v=i(regeneratorRuntime.mark((function t(e,r,n){var i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=Date.now()/1e3,t.next=3,this.postRaw(e,r,n);case 3:return s=t.sent,this._handleMeta(s.body,i),t.abrupt("return",s.body);case 6:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return v.apply(this,arguments)})},{key:"postRaw",value:(y=i(regeneratorRuntime.mark((function t(e,r,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._post(e).query(n).send(r));case 1:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return y.apply(this,arguments)})},{key:"_post",value:function(t){return o.superagent.post(this.endpoint+t).set("Authorization",this.token).set("accept","json")}},{key:"get",value:(d=i(regeneratorRuntime.mark((function t(e,r){var n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now()/1e3,t.next=3,this.getRaw(e,r);case 3:return i=t.sent,this._handleMeta(i.body,n),t.abrupt("return",i.body);case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return d.apply(this,arguments)})},{key:"getRaw",value:function(t,e){return t=t||"",o.superagent.get(this.endpoint+t).set("Authorization",this.token).set("accept","json").query(e)}},{key:"addPointsToHFEvent",value:(f=i(regeneratorRuntime.mark((function t(e,r,n){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("events/"+e+"/series",{format:"flatJSON",fields:r,points:n});case 2:if("ok"!==!(i=t.sent).status){t.next=5;break}throw new Error("Failed loading serie: "+JSON.stringify(i.status));case 5:return t.abrupt("return",i);case 6:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return f.apply(this,arguments)})},{key:"getEventsStreamed",value:(l=i(regeneratorRuntime.mark((function t(e,r){var n,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a(r,e.includeDeletions),i=null,"undefined"!=typeof window){t.next=8;break}return t.next=5,this.getRaw("events",e).buffer(!1).parse(n);case 5:i=t.sent,t.next=21;break;case 8:if("undefined"==typeof fetch){t.next=14;break}return t.next=11,u(this,e,n);case 11:i=t.sent,t.next=21;break;case 14:return console.log("WARNING: Browser does not support fetch() required by Pryv.Connection.getEventsStreamed()"),t.next=17,this.getRaw("events",e);case 17:(i=t.sent).body.eventsCount=0,i.body.events&&(i.body.events.forEach(r),i.body.eventsCount+=i.body.events.length,delete i.body.events),i.body.eventDeletions&&(i.body.eventDeletions.forEach(r),i.body.eventsCount+=i.body.eventDeletions.length,delete i.body.eventDeletions);case 21:return s=Date.now()/1e3,this._handleMeta(i.body,s),t.abrupt("return",i.body);case 24:case"end":return t.stop()}}),t,this)}))),function(t,e){return l.apply(this,arguments)})},{key:"createEventWithFile",value:(h=i(regeneratorRuntime.mark((function t(e,r){var n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._post("events").field("event",JSON.stringify(e)).attach("file",r);case 2:return n=t.sent,i=Date.now()/1e3,this._handleMeta(n.body,i),t.abrupt("return",n.body);case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return h.apply(this,arguments)})},{key:"createEventWithFormData",value:(c=i(regeneratorRuntime.mark((function t(e,r){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.append("event",JSON.stringify(e)),t.next=3,this._post("events").send(r);case 3:return n=t.sent,t.abrupt("return",n.body);case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return c.apply(this,arguments)})},{key:"_handleMeta",value:function(t,e){if(!t.meta)throw new Error("Cannot find .meta in response.");if(!t.meta.serverTime)throw new Error("Cannot find .meta.serverTime in response.");this._deltaTime.value=(this._deltaTime.value*this._deltaTime.weight+t.meta.serverTime-e)/++this._deltaTime.weight}},{key:"service",get:function(){return this._service||(this._service=new p(this.endpoint+"service/info")),this._service}},{key:"deltaTime",get:function(){return this._deltaTime.value}},{key:"apiEndpoint",get:function(){return o.buildPryvApiEndpoint(this)}}])&&s(e.prototype,r),n&&s(e,n),t}();t.exports=c;var p=r(1)},function(t,e,r){t.exports=r(6)},function(t,e,r){var n=r(7);t.exports=n},function(t,e,r){t.exports={Service:r(1),Connection:r(4),Browser:r(18),utils:r(0),version:r(23).version}},function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i;"undefined"!=typeof window?i=window:"undefined"==typeof self?(console.warn("Using browser-only version of superagent in non-browser environment"),i=void 0):i=self;var s=r(9),o=r(10),a=r(11),u=r(3),c=r(12),p=r(14);function h(){}t.exports=function(t,r){return"function"==typeof r?new e.Request("GET",t).end(r):1===arguments.length?new e.Request("GET",t):new e.Request(t,r)};var l=e=t.exports;e.Request=b,l.getXHR=function(){if(i.XMLHttpRequest&&(!i.location||"file:"!==i.location.protocol||!i.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw new Error("Browser-only version of superagent could not find XHR")};var f="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function d(t){if(!u(t))return t;var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&y(e,r,t[r]);return e.join("&")}function y(t,e,r){if(void 0!==r)if(null!==r)if(Array.isArray(r))r.forEach((function(r){y(t,e,r)}));else if(u(r))for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&y(t,"".concat(e,"[").concat(n,"]"),r[n]);else t.push(encodeURI(e)+"="+encodeURIComponent(r));else t.push(encodeURI(e))}function v(t){for(var e,r,n={},i=t.split("&"),s=0,o=i.length;s<o;++s)-1===(r=(e=i[s]).indexOf("="))?n[decodeURIComponent(e)]="":n[decodeURIComponent(e.slice(0,r))]=decodeURIComponent(e.slice(r+1));return n}function m(t){return/[/+]json($|[^-\w])/.test(t)}function g(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!==this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.headers=function(t){for(var e,r,n,i,s=t.split(/\r?\n/),o={},a=0,u=s.length;a<u;++a)-1!==(e=(r=s[a]).indexOf(":"))&&(n=r.slice(0,e).toLowerCase(),i=f(r.slice(e+1)),o[n]=i);return o}(this.xhr.getAllResponseHeaders()),this.header=this.headers,this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&t._responseType?this.body=this.xhr.response:this.body="HEAD"===this.req.method?null:this._parseBody(this.text?this.text:this.xhr.response)}function b(t,e){var r=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",(function(){var t,e=null,n=null;try{n=new g(r)}catch(t){return(e=new Error("Parser is unable to parse the response")).parse=!0,e.original=t,r.xhr?(e.rawResponse=void 0===r.xhr.responseType?r.xhr.responseText:r.xhr.response,e.status=r.xhr.status?r.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),r.callback(e)}r.emit("response",n);try{r._isResponseOK(n)||(t=new Error(n.statusText||n.text||"Unsuccessful HTTP response"))}catch(e){t=e}t?(t.original=e,t.response=n,t.status=n.status,r.callback(t,n)):r.callback(null,n)}))}function w(t,e,r){var n=l("DELETE",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n}l.serializeObject=d,l.parseString=v,l.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},l.serialize={"application/x-www-form-urlencoded":d,"application/json":o},l.parse={"application/x-www-form-urlencoded":v,"application/json":JSON.parse},c(g.prototype),g.prototype._parseBody=function(t){var e=l.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&m(this.type)&&(e=l.parse["application/json"]),e&&t&&(t.length>0||t instanceof Object)?e(t):null)},g.prototype.toError=function(){var t=this.req,e=t.method,r=t.url,n="cannot ".concat(e," ").concat(r," (").concat(this.status,")"),i=new Error(n);return i.status=this.status,i.method=e,i.url=r,i},l.Response=g,s(b.prototype),a(b.prototype),b.prototype.type=function(t){return this.set("Content-Type",l.types[t]||t),this},b.prototype.accept=function(t){return this.set("Accept",l.types[t]||t),this},b.prototype.auth=function(t,e,r){1===arguments.length&&(e=""),"object"===n(e)&&null!==e&&(r=e,e=""),r||(r={type:"function"==typeof btoa?"basic":"auto"});var i=function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(t,e,r,i)},b.prototype.query=function(t){return"string"!=typeof t&&(t=d(t)),t&&this._query.push(t),this},b.prototype.attach=function(t,e,r){if(e){if(this._data)throw new Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,r||e.name)}return this},b.prototype._getFormData=function(){return this._formData||(this._formData=new i.FormData),this._formData},b.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var r=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),r(t,e)},b.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},b.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},b.prototype.ca=b.prototype.agent,b.prototype.buffer=b.prototype.ca,b.prototype.write=function(){throw new Error("Streaming is not supported in browser version of superagent")},b.prototype.pipe=b.prototype.write,b.prototype._isHost=function(t){return t&&"object"===n(t)&&!Array.isArray(t)&&"[object Object]"!==Object.prototype.toString.call(t)},b.prototype.end=function(t){this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||h,this._finalizeQueryString(),this._end()},b.prototype._setUploadTimeout=function(){var t=this;this._uploadTimeout&&!this._uploadTimeoutTimer&&(this._uploadTimeoutTimer=setTimeout((function(){t._timeoutError("Upload timeout of ",t._uploadTimeout,"ETIMEDOUT")}),this._uploadTimeout))},b.prototype._end=function(){if(this._aborted)return this.callback(new Error("The request has been aborted even before .end() was called"));var t=this;this.xhr=l.getXHR();var e=this.xhr,r=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var r=e.readyState;if(r>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4===r){var n;try{n=e.status}catch(t){n=0}if(!n){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var n=function(e,r){r.total>0&&(r.percent=r.loaded/r.total*100,100===r.percent&&clearTimeout(t._uploadTimeoutTimer)),r.direction=e,t.emit("progress",r)};if(this.hasListeners("progress"))try{e.addEventListener("progress",n.bind(null,"download")),e.upload&&e.upload.addEventListener("progress",n.bind(null,"upload"))}catch(t){}e.upload&&this._setUploadTimeout();try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(t){return this.callback(t)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!==this.method&&"HEAD"!==this.method&&"string"!=typeof r&&!this._isHost(r)){var i=this._header["content-type"],s=this._serializer||l.serialize[i?i.split(";")[0]:""];!s&&m(i)&&(s=l.serialize["application/json"]),s&&(r=s(r))}for(var o in this.header)null!==this.header[o]&&Object.prototype.hasOwnProperty.call(this.header,o)&&e.setRequestHeader(o,this.header[o]);this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0===r?null:r)},l.agent=function(){return new p},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach((function(t){p.prototype[t.toLowerCase()]=function(e,r){var n=new l.Request(t,e);return this._setDefaults(n),r&&n.end(r),n}})),p.prototype.del=p.prototype.delete,l.get=function(t,e,r){var n=l("GET",t);return"function"==typeof e&&(r=e,e=null),e&&n.query(e),r&&n.end(r),n},l.head=function(t,e,r){var n=l("HEAD",t);return"function"==typeof e&&(r=e,e=null),e&&n.query(e),r&&n.end(r),n},l.options=function(t,e,r){var n=l("OPTIONS",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},l.del=w,l.delete=w,l.patch=function(t,e,r){var n=l("PATCH",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},l.post=function(t,e,r){var n=l("POST",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},l.put=function(t,e,r){var n=l("PUT",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n}},function(t,e,r){function n(t){if(t)return function(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}(t)}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+t],this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),r=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(r){n=0;for(var i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,e)}return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e){t.exports=i,i.default=i,i.stable=o,i.stableStringify=o;var r=[],n=[];function i(t,e,i){var s;for(!function t(e,i,s,o){var a;if("object"==typeof e&&null!==e){for(a=0;a<s.length;a++)if(s[a]===e){var u=Object.getOwnPropertyDescriptor(o,i);return void(void 0!==u.get?u.configurable?(Object.defineProperty(o,i,{value:"[Circular]"}),r.push([o,i,e,u])):n.push([e,i]):(o[i]="[Circular]",r.push([o,i,e])))}if(s.push(e),Array.isArray(e))for(a=0;a<e.length;a++)t(e[a],a,s,e);else{var c=Object.keys(e);for(a=0;a<c.length;a++){var p=c[a];t(e[p],p,s,e)}}s.pop()}}(t,"",[],void 0),s=0===n.length?JSON.stringify(t,e,i):JSON.stringify(t,a(e),i);0!==r.length;){var o=r.pop();4===o.length?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}return s}function s(t,e){return t<e?-1:t>e?1:0}function o(t,e,i){var o,u=function t(e,i,o,a){var u;if("object"==typeof e&&null!==e){for(u=0;u<o.length;u++)if(o[u]===e){var c=Object.getOwnPropertyDescriptor(a,i);return void(void 0!==c.get?c.configurable?(Object.defineProperty(a,i,{value:"[Circular]"}),r.push([a,i,e,c])):n.push([e,i]):(a[i]="[Circular]",r.push([a,i,e])))}if("function"==typeof e.toJSON)return;if(o.push(e),Array.isArray(e))for(u=0;u<e.length;u++)t(e[u],u,o,e);else{var p={},h=Object.keys(e).sort(s);for(u=0;u<h.length;u++){var l=h[u];t(e[l],l,o,e),p[l]=e[l]}if(void 0===a)return p;r.push([a,i,e]),a[i]=p}o.pop()}}(t,"",[],void 0)||t;for(o=0===n.length?JSON.stringify(u,e,i):JSON.stringify(u,a(e),i);0!==r.length;){var c=r.pop();4===c.length?Object.defineProperty(c[0],c[1],c[3]):c[0][c[1]]=c[2]}return o}function a(t){return t=void 0!==t?t:function(t,e){return e},function(e,r){if(n.length>0)for(var i=0;i<n.length;i++){var s=n[i];if(s[1]===e&&s[0]===r){r="[Circular]",n.splice(i,1);break}}return t.call(this,e,r)}}},function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i=r(3);function s(t){if(t)return function(t){for(var e in s.prototype)Object.prototype.hasOwnProperty.call(s.prototype,e)&&(t[e]=s.prototype[e]);return t}(t)}t.exports=s,s.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),clearTimeout(this._uploadTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,delete this._uploadTimeoutTimer,this},s.prototype.parse=function(t){return this._parser=t,this},s.prototype.responseType=function(t){return this._responseType=t,this},s.prototype.serialize=function(t){return this._serializer=t,this},s.prototype.timeout=function(t){if(!t||"object"!==n(t))return this._timeout=t,this._responseTimeout=0,this._uploadTimeout=0,this;for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;case"upload":this._uploadTimeout=t.upload;break;default:console.warn("Unknown timeout option",e)}return this},s.prototype.retry=function(t,e){return 0!==arguments.length&&!0!==t||(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var o=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];s.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(t,e);if(!0===r)return!0;if(!1===r)return!1}catch(t){console.error(t)}if(e&&e.status&&e.status>=500&&501!==e.status)return!0;if(t){if(t.code&&o.includes(t.code))return!0;if(t.timeout&&"ECONNABORTED"===t.code)return!0;if(t.crossDomain)return!0}return!1},s.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this.timedoutError=null,this._end()},s.prototype.then=function(t,e){var r=this;if(!this._fullfilledPromise){var n=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise((function(t,e){n.on("abort",(function(){if(!(r._maxRetries&&r._maxRetries>r._retries))if(r.timedout&&r.timedoutError)e(r.timedoutError);else{var t=new Error("Aborted");t.code="ABORTED",t.status=r.status,t.method=r.method,t.url=r.url,e(t)}})),n.end((function(r,n){r?e(r):t(n)}))}))}return this._fullfilledPromise.then(t,e)},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.use=function(t){return t(this),this},s.prototype.ok=function(t){if("function"!=typeof t)throw new Error("Callback required");return this._okCallback=t,this},s.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},s.prototype.get=function(t){return this._header[t.toLowerCase()]},s.prototype.getHeader=s.prototype.get,s.prototype.set=function(t,e){if(i(t)){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&this.set(r,t[r]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},s.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},s.prototype.field=function(t,e){if(null==t)throw new Error(".field(name, val) name can not be empty");if(this._data)throw new Error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()");if(i(t)){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&this.field(r,t[r]);return this}if(Array.isArray(e)){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&this.field(t,e[n]);return this}if(null==e)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof e&&(e=String(e)),this._getFormData().append(t,e),this},s.prototype.abort=function(){return this._aborted||(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort")),this},s.prototype._auth=function(t,e,r,n){switch(r.type){case"basic":this.set("Authorization","Basic ".concat(n("".concat(t,":").concat(e))));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer ".concat(t))}return this},s.prototype.withCredentials=function(t){return void 0===t&&(t=!0),this._withCredentials=t,this},s.prototype.redirects=function(t){return this._maxRedirects=t,this},s.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw new TypeError("Invalid argument");return this._maxResponseSize=t,this},s.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},s.prototype.send=function(t){var e=i(t),r=this._header["content-type"];if(this._formData)throw new Error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()");if(e&&!this._data)Array.isArray(t)?this._data=[]:this._isHost(t)||(this._data={});else if(t&&this._data&&this._isHost(this._data))throw new Error("Can't merge these send calls");if(e&&i(this._data))for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(this._data[n]=t[n]);else"string"==typeof t?(r||this.type("form"),r=this._header["content-type"],this._data="application/x-www-form-urlencoded"===r?this._data?"".concat(this._data,"&").concat(t):t:(this._data||"")+t):this._data=t;return!e||this._isHost(t)||r||this.type("json"),this},s.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},s.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.includes("?")?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var r=this.url.slice(e+1).split("&");"function"==typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.slice(0,e)+"?"+r.join("&")}}},s.prototype._appendQueryString=function(){console.warn("Unsupported")},s.prototype._timeoutError=function(t,e,r){if(!this._aborted){var n=new Error("".concat(t+e,"ms exceeded"));n.timeout=e,n.code="ECONNABORTED",n.errno=r,this.timedout=!0,this.timedoutError=n,this.abort(),this.callback(n)}},s.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout((function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")}),this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout((function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")}),this._responseTimeout))}},function(t,e,r){"use strict";var n=r(13);function i(t){if(t)return function(t){for(var e in i.prototype)Object.prototype.hasOwnProperty.call(i.prototype,e)&&(t[e]=i.prototype[e]);return t}(t)}t.exports=i,i.prototype.get=function(t){return this.header[t.toLowerCase()]},i.prototype._setHeaderProperties=function(t){var e=t["content-type"]||"";this.type=n.type(e);var r=n.params(e);for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(this[i]=r[i]);this.links={};try{t.link&&(this.links=n.parseLinks(t.link))}catch(t){}},i.prototype._setStatusProperties=function(t){var e=t/100|0;this.statusCode=t,this.status=this.statusCode,this.statusType=e,this.info=1===e,this.ok=2===e,this.redirect=3===e,this.clientError=4===e,this.serverError=5===e,this.error=(4===e||5===e)&&this.toError(),this.created=201===t,this.accepted=202===t,this.noContent=204===t,this.badRequest=400===t,this.unauthorized=401===t,this.notAcceptable=406===t,this.forbidden=403===t,this.notFound=404===t,this.unprocessableEntity=422===t}},function(t,e,r){"use strict";e.type=function(t){return t.split(/ *; */).shift()},e.params=function(t){return t.split(/ *; */).reduce((function(t,e){var r=e.split(/ *= */),n=r.shift(),i=r.shift();return n&&i&&(t[n]=i),t}),{})},e.parseLinks=function(t){return t.split(/ *, */).reduce((function(t,e){var r=e.split(/ *; */),n=r[0].slice(1,-1);return t[r[1].split(/ *= */)[1].slice(1,-1)]=n,t}),{})},e.cleanHeader=function(t,e){return delete t["content-type"],delete t["content-length"],delete t["transfer-encoding"],delete t.host,e&&(delete t.authorization,delete t.cookie),t}},function(t,e,r){"use strict";function n(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function s(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert","disableTLSCerts"].forEach((function(t){s.prototype[t]=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return this._defaults.push({fn:t,args:r}),this}})),s.prototype._setDefaults=function(t){this._defaults.forEach((function(e){t[e.fn].apply(t,n(e.args))}))},t.exports=s},function(t,e,r){function n(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(i,s){var o=t.apply(e,r);function a(t){n(o,i,s,a,u,"next",t)}function u(t){n(o,i,s,a,u,"throw",t)}a(void 0)}))}}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=r(0),a=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._assets=e,this._assetsURL=r}var e,r,n,a,c,p,h,l,f;return e=t,r=[{key:"get",value:function(t){var e=Object.assign({},this._assets);return t&&t.split(":").forEach((function(t){if(void 0===(e=e[t]))return e})),e}},{key:"getUrl",value:function(t){var e=this.get(t);if("string"!=typeof e)throw new Error(e+" returned "+value);return this.relativeURL(e)}},{key:"relativeURL",value:function(t){return function(t,e){var r=location;t&&((r=document.createElement("a")).href=t);for(var n,i,s="",o=r.pathname.replace(/[^\/]*$/,e.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),a=0;(i=o.indexOf("/../",a))>-1;a=i+n)n=/^\/(?:\.\.\/)*/.exec(o.slice(i))[0].length,s=(s+o.substring(a,i)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(n-1)/3+"}$"),"/");var u=r.port?":"+r.port:"";return r.protocol+"//"+r.hostname+u+s+o.substr(a)}(this._assets.baseUrl||this._assetsURL,t)}},{key:"setAllDefaults",value:(f=i(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setFavicon(),t.next=3,this.loadCSS();case 3:case"end":return t.stop()}}),t,this)}))),function(){return f.apply(this,arguments)})},{key:"setFavicon",value:function(){var t=document.querySelector("link[rel*='icon']")||document.createElement("link");t.type="image/x-icon",t.rel="shortcut icon",t.href=this.relativeURL(this._assets.favicon.default.url),document.getElementsByTagName("head")[0].appendChild(t)}},{key:"loadCSS",value:(l=i(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:u(this.relativeURL(this._assets.css.default.url));case 1:case"end":return t.stop()}}),t,this)}))),function(){return l.apply(this,arguments)})},{key:"loginButtonLoadCSS",value:(h=i(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:u(this.relativeURL(this._assets["lib-js"].buttonSignIn.css));case 1:case"end":return t.stop()}}),t,this)}))),function(){return h.apply(this,arguments)})},{key:"loginButtonGetHTML",value:(p=i(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.superagent.get(this.relativeURL(this._assets["lib-js"].buttonSignIn.html)).set("accept","html");case 2:return e=t.sent,t.abrupt("return",e.text);case 4:case"end":return t.stop()}}),t,this)}))),function(){return p.apply(this,arguments)})},{key:"loginButtonGetMessages",value:(c=i(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.superagent.get(this.relativeURL(this._assets["lib-js"].buttonSignIn.messages)).set("accept","json");case 2:return e=t.sent,t.abrupt("return",e.body);case 4:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})}],n=[{key:"setup",value:(a=i(regeneratorRuntime.mark((function e(r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.superagent.get(r).set("accept","json");case 2:return n=e.sent,e.abrupt("return",new t(n.body,r));case 4:case"end":return e.stop()}}),e)}))),function(t){return a.apply(this,arguments)})}],r&&s(e.prototype,r),n&&s(e,n),t}();function u(t){var e=document.getElementsByTagName("head")[0],r=document.createElement("link");r.id=t,r.rel="stylesheet",r.type="text/css",r.href=t,r.media="all",e.appendChild(r)}t.exports=a},function(t,e){var r=['"events":[','"eventDeletions":['];t.exports=function(t,e){var n=0,i="",s=null,o=0,a=!1,u=!1,c=0,p=0,h=0,l=0,f=1,d=2,y=l;function v(){switch(y){case l:(t=i.indexOf(r[n]))>0&&(0===n&&(s=i.substring(0,t)),i=i.substr(t+r[n].length),y=f,m());break;case f:m();break;default:s+=i,i=""}var t}function m(){for(;c<i.length&&y===f;)if(u)u=!1,c++;else{switch(i.charCodeAt(c)){case 93:if(0===o){if(0!==c)throw new Error("Found trailling ] in mid-course");if(0===n&&e)return y=l,void(n=1);y=d;var r="";1===n&&(r='"eventDeletionsCount":'+h+","),i=r+'"eventsCount":'+p+i.substr(1)}break;case 92:u=!0;break;case 123:a||o++;break;case 34:a=!a;break;case 125:if(a||o--,0===o){var s=44===i.charCodeAt(0)?1:0,v=i.substring(s,c+1);0===n?p++:h++,i=i.substr(c+1),m=v,t(JSON.parse(m)),c=-1}}c++}var m}return function(t,e){t.setEncoding("utf8"),t.on("data",(function(t){i+=t,v()})),t.on("end",(function(){var r,n;try{t.text=s+i,n=t.text&&JSON.parse(t.text)}catch(e){(r=e).rawResponse=t.text||null,r.statusCode=t.statusCode}finally{e(r,n)}}))}}},function(t,e,r){function n(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw o}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function s(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){s(o,n,i,a,u,"next",t)}function u(t){s(o,n,i,a,u,"throw",t)}a(void 0)}))}}function a(){return(a=o(regeneratorRuntime.mark((function t(e,r,i){var s,o,a,u,c,p,h,l,f,d,y,v,m,g,b;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s={ondata:null,onend:null,encoding:"utf8"},i(o={setEncoding:function(t){s.encoding=t},on:function(t,e){s["on"+t]=e}},(function(t,e){a=t,u=e})),(c=new URL(e.endpoint+"events")).search=new URLSearchParams(r),p={method:"GET",headers:{Accept:"application/jon"}},e.token&&(p.headers.Authorization=e.token),t.next=9,fetch(c,p);case 9:h=t.sent,l=h.body.getReader();case 11:return t.next=14,l.read();case 14:if(f=t.sent,d=f.done,y=f.value,s.ondata(new TextDecoder(s.encoding).decode(y)),!d){t.next=21;break}return s.onend(),t.abrupt("break",23);case 21:t.next=11;break;case 23:if(!a){t.next=25;break}throw new Error(a);case 25:v={text:o.text,body:u,statusCode:h.status,headers:{}},m=n(h.headers.entries());try{for(m.s();!(g=m.n()).done;)b=g.value,v.headers[b[0]]=b[1]}catch(t){m.e(t)}finally{m.f()}return t.abrupt("return",v);case 29:case"end":return t.stop()}}),t)})))).apply(this,arguments)}t.exports=function(t,e,r){return a.apply(this,arguments)}},function(t,e,r){function n(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(i,s){var o=t.apply(e,r);function a(t){n(o,i,s,a,u,"next",t)}function u(t){n(o,i,s,a,u,"throw",t)}a(void 0)}))}}var s=r(19),o=r(2);function a(){return(a=i(regeneratorRuntime.mark((function t(e,r,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new s(e,r,n).init());case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}t.exports={setupAuth:function(t,e,r){return a.apply(this,arguments)},AuthStates:o,serviceInfoFromUrl:s.getServiceInfoFromURL}},function(t,e,r){function n(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(i,s){var o=t.apply(e,r);function a(t){n(o,i,s,a,u,"next",t)}function u(t){n(o,i,s,a,u,"throw",t)}a(void 0)}))}}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=r(0),a=r(1),u=r(20),c=r(2),p=r(22),h=/[?#&]+([^=&]+)=([^&]*)/g,l=/[?#&]+prYv([^=&]+)=([^&]*)/g,f=function(){function t(e,r,n){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stateChangeListners=[],this.settings=e,this.serviceInfoUrl=r,this.serviceCustomizations=n,!e)throw new Error("settings cannot be null");this.settings.spanButtonID?(this.loginButton=new u(this),this.stateChangeListners.push(this.loginButton.onStateChange.bind(this.loginButton))):document&&console.log("WARNING: Pryv.Browser initialized with no spanButtonID");try{if(!this.settings.onStateChange)throw new Error("Missing settings.onStateChange");if(this.stateChangeListners.push(this.settings.onStateChange),!this.settings.authRequest)throw new Error("Missing settings.authRequest");if(this.settings.authRequest.returnURL=t.getReturnURL(this.settings.authRequest.returnURL),!this.settings.authRequest.requestingAppId)throw new Error("Missing settings.authRequest.requestingAppId");if(this.cookieKey="pryv-libjs-"+this.settings.authRequest.requestingAppId,!this.settings.authRequest.requestedPermissions)throw new Error("Missing settings.authRequest.requestedPermissions");this.serviceInfoUrl}catch(t){throw this.state={id:c.ERROR,message:"During initialization",error:t},t}}var e,r,n,f,d,y,v,m;return e=t,r=[{key:"init",value:(m=i(regeneratorRuntime.mark((function e(){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state={id:c.LOADING},!this.pryvService){e.next=3;break}throw new Error("Browser service already initialized");case 3:return this.pryvService=new a(this.serviceInfoUrl,this.serviceCustomizations),e.prev=4,e.next=7,this.pryvService.info();case 7:this.pryvServiceInfo=e.sent,e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(4),this.state={id:c.ERROR,message:"Cannot fetch service/info",error:e.t0},e.t0;case 14:if(!this.loginButton){e.next=24;break}return e.prev=15,e.next=18,this.loginButton.loadAssets(this.pryvService);case 18:e.next=24;break;case 20:throw e.prev=20,e.t1=e.catch(15),this.state={id:c.ERROR,message:"Cannot fetch button visuals",error:e.t1},e.t1;case 24:if(!(r=t.getQueryParamsFromURL()).prYvkey){e.next=37;break}return e.prev=26,e.next=29,o.superagent.get(this.pryvServiceInfo.access+r.prYvkey);case 29:n=e.sent,this.processAccess(n.body),e.next=36;break;case 33:e.prev=33,e.t2=e.catch(26),this.state={id:c.ERROR,message:"Cannot fetch result",error:e.t2};case 36:return e.abrupt("return",this.pryvService);case 37:i=null;try{i=p.get(this.cookieKey)}catch(t){console.log(t)}return i?this.state={id:c.AUTHORIZED,apiEndpoint:i.apiEndpoint,displayName:i.displayName,action:this.logOut}:this.readyAndClean(),e.abrupt("return",this.pryvService);case 41:case"end":return e.stop()}}),e,this,[[4,10],[15,20],[26,33]])}))),function(){return m.apply(this,arguments)})},{key:"readyAndClean",value:function(){p.del(this.cookieKey),this.accessData=null,this.state={id:c.INITIALIZED,serviceInfo:this.serviceInfo,action:this.openLoginPage}}},{key:"postAccess",value:(v=i(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o.superagent.post(this.pryvServiceInfo.access).set("accept","json").send(this.settings.authRequest);case 3:return e=t.sent,t.abrupt("return",e.body);case 7:throw t.prev=7,t.t0=t.catch(0),this.state={id:c.ERROR,message:"Requesting access",error:t.t0},t.t0;case 11:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(){return v.apply(this,arguments)})},{key:"getAccess",value:(y=i(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.superagent.get(this.accessData.poll).set("accept","json");case 2:return e=t.sent,t.abrupt("return",e.body);case 4:case"end":return t.stop()}}),t,this)}))),function(){return y.apply(this,arguments)})},{key:"poll",value:(d=i(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("NEED_SIGNIN"===this.accessData.status){t.next=3;break}return this.polling=!1,t.abrupt("return");case 3:if(!this.settings.authRequest.returnURL){t.next=5;break}return t.abrupt("return");case 5:return this.polling=!0,t.t0=this,t.next=9,this.getAccess();case 9:t.t1=t.sent,t.t0.processAccess.call(t.t0,t.t1),setTimeout(this.poll.bind(this),this.accessData.poll_rate_ms);case 12:case"end":return t.stop()}}),t,this)}))),function(){return d.apply(this,arguments)})},{key:"processAccess",value:function(t){if(!t||!t.status)throw this.state={id:c.ERROR,message:"Invalid Access data response",error:new Error("Invalid Access data response")},this.state.error;switch(this.accessData=t,this.accessData.status){case"ERROR":this.state={id:c.ERROR,message:"Error on the backend"};break;case"ACCEPTED":var e=a.buildAPIEndpoint(this.pryvServiceInfo,this.accessData.username,this.accessData.token);p.set(this.cookieKey,{apiEndpoint:e,displayName:this.accessData.username}),this.state={id:c.AUTHORIZED,apiEndpoint:e,displayName:this.accessData.username,action:this.logOut}}}},{key:"openLoginPage",value:(f=i(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("OpenLogin",this),this.pryvServiceInfo){t.next=3;break}throw new Error("Browser service must be initialized first");case 3:if(this.accessData){t.next=9;break}return t.t0=this,t.next=7,this.postAccess();case 7:t.t1=t.sent,t.t0.processAccess.call(t.t0,t.t1);case 9:"NEED_SIGNIN"===this.accessData.status&&this.popupLogin(),this.polling||this.poll();case 11:case"end":return t.stop()}}),t,this)}))),function(){return f.apply(this,arguments)})},{key:"logOut",value:function(){var t=this.loginButton?this.loginButton.myMessages.LOGOUT_CONFIRM:"Logout ?";confirm(t)&&this.readyAndClean()}},{key:"popupLogin",value:function(){if(!this.accessData||!this.accessData.url)throw new Error("Pryv Sign-In Error: NO SETUP. Please call Browser.setupAuth() first.");if(this.settings.authRequest.returnURL)location.href=this.accessData.url;else{var t=void 0!==window.screenX?window.screenX:window.screenLeft,e=void 0!==window.screenY?window.screenY:window.screenTop,r=void 0!==window.outerWidth?window.outerWidth:document.body.clientWidth,n=void 0!==window.outerHeight?window.outerHeight:document.body.clientHeight-22,i="width=270,height=420,left="+parseInt(t+(r-270)/2,10)+",top="+parseInt(e+(n-420)/2.5,10)+",scrollbars=yes",s=this.accessData.authUrl||this.accessData.url;this.popup=window.open(s,"prYv Sign-in",i),this.popup?window.focus&&this.popup.focus():console.log("FAILED_TO_OPEN_WINDOW")}}},{key:"state",set:function(t){var e=this;this._state=t,this.stateChangeListners.map((function(t){try{t(e.state)}catch(t){console.log(t)}}))},get:function(){return this._state}}],n=[{key:"getReturnURL",value:function(e,r,n){var i=e||"auto#",s=r||window.location.href,o=i.slice(-1);if("#&?".indexOf(o)<0)throw new Error('Pryv access: Last character of --returnURL setting-- is not "?", "&" or "#": '+i);return!(0===i.indexOf("auto")&&!t.browserIsMobileOrTablet(n))&&((0===i.indexOf("auto")&&t.browserIsMobileOrTablet(n)||0===i.indexOf("self"))&&(i=s+i.substring(4)),t.cleanURLFromPrYvParams(i))}},{key:"browserIsMobileOrTablet",value:function(t){var e,r=t||navigator,n=!1;return e=r.userAgent||r.vendor||r.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(n=!0),n}},{key:"getQueryParamsFromURL",value:function(t){t=t||window.location.href;var e={};return t.replace(h,(function(t,r,n){e[r]=decodeURIComponent(n)})),e}},{key:"getServiceInfoFromURL",value:function(e){return t.getQueryParamsFromURL(e)[t.options.SERVICE_INFO_QUERY_PARAM_KEY]}},{key:"getStatusFromURL",value:function(e){return t.getQueryParamsFromURL(e).prYvstatus}},{key:"cleanURLFromPrYvParams",value:function(t){return t.replace(l,"")}}],r&&s(e.prototype,r),n&&s(e,n),t}();f.options={SERVICE_INFO_QUERY_PARAM_KEY:"pryvServiceInfoUrl"},t.exports=f},function(t,e,r){function n(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=r(21),o=r(2),a=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.languageCode=e.settings.authRequest.languageCode||"en",this.myMessages=s(this.languageCode),this.loginButtonSpan=document.getElementById(e.settings.spanButtonID),!this.loginButtonSpan)throw new Error("No Cannot find SpanId: "+e.settings.spanButtonID+" in DOM");this.loginButtonText=this.loginButtonSpan,this.loginButtonSpan.addEventListener("click",this.onClick.bind(this)),this.auth=e,this.onStateChange({id:o.LOADING})}var e,r,a,u,c;return e=t,(r=[{key:"loadAssets",value:(u=regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.assets();case 2:return(r=t.sent).loginButtonLoadCSS(),t.next=6,r.loginButtonGetHTML();case 6:return this.loginButtonSpan.innerHTML=t.sent,this.loginButtonText=document.getElementById("pryv-access-btn-text"),t.next=10,r.loginButtonGetMessages();case 10:(n=t.sent).LOADING?this.myMessages=s(this.languageCode,n):console.log("WARNING Messages cannot be loaded using defaults: ",n),this.onStateChange(),this.refreshText();case 14:case"end":return t.stop()}}),t,this)})),c=function(){var t=this,e=arguments;return new Promise((function(r,i){var s=u.apply(t,e);function o(t){n(s,r,i,o,a,"next",t)}function a(t){n(s,r,i,o,a,"throw",t)}o(void 0)}))},function(t){return c.apply(this,arguments)})},{key:"refreshText",value:function(){this.loginButtonText&&(this.loginButtonText.innerHTML=this.text)}},{key:"onClick",value:function(){this.auth.state.action&&this.auth.state.action.apply(this.auth)}},{key:"onStateChange",value:function(t){switch(t&&(this.lastState=t),this.lastState.id){case o.ERROR:this.text=this.myMessages.ERROR+": "+this.lastState.message;break;case o.LOADING:this.text=this.myMessages.LOADING;break;case o.INITIALIZED:this.text=this.myMessages.LOGIN+": "+this.auth.pryvServiceInfo.name;break;case o.AUTHORIZED:this.text=this.lastState.displayName;break;default:console.log("WARNING Unhandled state for Login: "+this.lastState.id)}this.refreshText()}}])&&i(e.prototype,r),a&&i(e,a),t}();t.exports=a},function(t,e){var r={LOADING:{en:"..."},ERROR:{en:"Error",fr:"Erreur"},LOGIN:{en:"Signin",fr:"Login"},LOGOUT_CONFIRM:{en:"Logout ?",fr:"Se deconnecter ?"}};t.exports=function(t,e){var n=e||r,i={};return Object.keys(n).map((function(e){i[e]=n[e][t]||n[e].en})),i}},function(t,e,r){var n=r(0);function i(t,e,r){if(n.isBrowser()){r=r||365;var i=new Date,s=window.location.hostname,o=window.location.pathname;i.setDate(i.getDate()+r);var a=encodeURIComponent(t)+"="+encodeURIComponent(JSON.stringify(e))+";expires="+i.toGMTString()+";domain=."+s+";path="+o;r>=0&&(a+=";SameSite=Strict"),document.cookie=a}}e.set=i,e.get=function(t){var e=encodeURIComponent(t);if(n.isBrowser()){var r=("; "+document.cookie).split("; "+e+"=");return 2==r.length?JSON.parse(decodeURIComponent(r.pop().split(";").shift())):void 0}},e.del=function(t){i(t,{deleted:!0},-1)}},function(t){t.exports=JSON.parse('{"name":"pryv","version":"2.0.3","homepage":"https://github.com/pryv/lib-js","description":"Pryv Javascript Library","keywords":["Pryv"],"repository":{"type":"git","url":"git://github.com/pryv/lib-js"},"bugs":{"url":"https://github.com/pryv/lib-js/issues"},"author":{"name":"Pryv S.A."},"main":"src/index.js","license":"BSD-3-Clause","scripts":{"setup":"./scripts/setup-environment-dev.sh","build":"webpack --config webpack.config.js","doc":"node node_modules/jsdoc/jsdoc.js -c .jsdoc-conf.json","test":"mocha --reporter spec  test/**/*.test.js","test-debug":"mocha --inpect-brk=40000 --reporter spec  test/**/*.test.js ","test:browser":"npm run build; ","cover":"nyc npm run test && npm run cover:report","cover:report":"nyc report --reporter=lcov --reporter=html","webserver":"node node_modules/rec-la/webserver/main.js ./dist 9443","gh-pages":"./scripts/upload.sh","clear":"rm -r dist/ && npm run setup"},"contributors":[{"name":"Pierre-Mikael Legris","email":"perki@pryv.com"}],"dependencies":{"superagent":"^5.2.2"},"devDependencies":{"@pryv/lib-js-common":"git+https://github.com/pryv/lib-js-common.git","@pryv/monitor":"^1.0.0","@pryv/socket.io":"^1.0.1","chai":"^4.2.0","chai-as-promised":"^7.1.1","cuid":"^2.1.8","jsdoc":"^3.6.4","mocha":"^6.2.3","node-fetch":"^2.6.0","nyc":"^14.1.1","rec-la":"^0.1.13","universal-url":"^2.0.0","zombie":"^6.1.4"}}')}]);
//# sourceMappingURL=pryv.js.map