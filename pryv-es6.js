var Pryv=function(t){var e={};function r(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(s,n,function(e){return t[e]}.bind(null,n));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e,r){const s=/(.+):\/\/(.+)@(.+)/gm,n=/(.+):\/\/(.+)/gm,i={superagent:r(8),isBrowser:function(){return"undefined"!=typeof window},extractTokenAndApiEndpoint:function(t){s.lastIndex=0;const e=s.exec(t);if(null!==e)return e[3].endsWith("/")||(e[3]+="/"),{endpoint:e[1]+"://"+e[3],token:e[2]};n.lastIndex=0;const r=n.exec(t);if(null===r)throw new Error("Cannot find endpoint, invalid URL format");return r[2].endsWith("/")||(r[2]+="/"),{endpoint:r[1]+"://"+r[2],token:null}},buildPryvApiEndpoint:function(t){if(!t.token){let e=t.endpoint+"";return t.endpoint.endsWith("/")||(e+="/"),e}n.lastIndex=0;let e=n.exec(t.endpoint);return e[2].endsWith("/")||(e[2]+="/"),e[1]+"://"+t.token+"@"+e[2]},extractUsernameFromAPIAndEndpoint:function(t,e){const{endpoint:r}=i.extractTokenAndApiEndpoint(e),s=t.indexOf("{username}"),n=t.length-s-10;if(s<5)throw new Error("Invalid API schema with no {username} placeholder");const o=r.slice(s,-n);if(t.replace("{username}",o)!==r)throw new Error("serviceInfoApi "+t+" schema does not match apiEndpoint: "+e);return o}};t.exports=i},function(t,e,r){const s=r(0),n=r(15);class i{constructor(t,e){this._pryvServiceInfo=null,this._assets=null,this._pryvServiceInfoUrl=t,this._pryvServiceCustomizations=e}async info(t){if(t||!this._pryvServiceInfo){let t={};if(this._pryvServiceInfoUrl){t=(await s.superagent.get(this._pryvServiceInfoUrl).set("Access-Control-Allow-Origin","*").set("accept","json")).body}Object.assign(t,this._pryvServiceCustomizations),this.setServiceInfo(t)}return this._pryvServiceInfo}setServiceInfo(t){if(!t.name)throw new Error("Invalid data from service/info");["access","api","register"].forEach(e=>{"/"!==t[e].slice(-1)&&(t[e]+="/")}),this._pryvServiceInfo=t}async assets(t){if(!t&&this._assets)return this._assets;{const t=await this.info();return t.assets&&t.assets.definitions?(this._assets=await n.setup(t.assets.definitions),this._assets):(console.log("Warning: no assets for this service"),null)}}infoSync(){return this._pryvServiceInfo}async apiEndpointFor(t,e){const r=await this.info();return i.buildAPIEndpoint(r,t,e)}static buildAPIEndpoint(t,e,r){const n=t.api.replace("{username}",e);return s.buildPryvApiEndpoint({endpoint:n,token:r})}async login(t,e,r,n){const a=await this.apiEndpointFor(t);try{const c={accept:"json"};n=n||(await this.info()).register,s.isBrowser()||(c.Origin=n);const u=await s.superagent.post(a+"auth/login").set(c).send({username:t,password:e,appId:r});if(!u.body.token)throw new Error("Invalid login response: "+u.body);return new o(i.buildAPIEndpoint(await this.info(),t,u.body.token),this)}catch(t){if(t.response&&t.response.body&&t.response.body.error&&t.response.body.error.message)throw new Error(t.response.body.error.message)}}}t.exports=i;const o=r(4)},function(t,e){t.exports={ERROR:"error",LOADING:"loading",INITIALIZED:"initialized",AUTHORIZED:"authorized",LOGOUT:"logout"}},function(t,e,r){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t.exports=function(t){return null!==t&&"object"===s(t)}},function(t,e,r){const s=r(0),n=r(16),i=r(17);t.exports=class{constructor(t,e){const{token:r,endpoint:n}=s.extractTokenAndApiEndpoint(t);if(this.token=r,this.endpoint=n,this.options={},this.options.chunkSize=1e3,this._deltaTime={value:0,weight:0},!e instanceof o)throw new Error("Invalid service param");this._service=e}get service(){return this._service||(this._service=new o(this.endpoint+"service/info")),this._service}async username(){const t=await this.service.info();return s.extractUsernameFromAPIAndEndpoint(t.api,this.endpoint)}async api(t,e){return await this._chunkedBatchCall(t,e,function(t){return this.post("",t)}.bind(this))}async _chunkedBatchCall(t,e,r){if(!Array.isArray(t))throw new Error("Pryv.api() takes an array as input");const s=[];let n=0;for(let i=0;t.length>=i;i+=this.options.chunkSize){const o=[],a=Math.min(i+this.options.chunkSize,t.length);for(let e=i;e<a;e++)o.push({method:t[e].method,params:t[e].params});const c=await r(o);if(!c||!Array.isArray(c.results))throw new Error("API call result is not an Array: "+JSON.stringify(c));if(c.results.length!=o.length)throw new Error("API call result Array does not match request: "+JSON.stringify(c));for(let e=0;e<c.results.length;e++)t[e+i].handleResult&&await t[e+i].handleResult.call(null,c.results[e]);Array.prototype.push.apply(s,c.results),n=Math.round(100*s.length/t.length),e&&e(n,s)}return s}async post(t,e,r){const s=Date.now()/1e3,n=await this.postRaw(t,e,r);return this._handleMeta(n.body,s),n.body}async postRaw(t,e,r){return this._post(t).query(r).send(e)}_post(t){return s.superagent.post(this.endpoint+t).set("Authorization",this.token).set("accept","json")}async get(t,e){const r=Date.now()/1e3,s=await this.getRaw(t,e);return this._handleMeta(s.body,r),s.body}getRaw(t,e){return t=t||"",s.superagent.get(this.endpoint+t).set("Authorization",this.token).set("accept","json").query(e)}async addPointsToHFEvent(t,e,r){const s=await this.post("events/"+t+"/series",{format:"flatJSON",fields:e,points:r});if("ok"===!s.status)throw new Error("Failed loading serie: "+JSON.stringify(s.status));return s}async getEventsStreamed(t,e){const r=n(e,t.includeDeletions);let s=null;"undefined"==typeof window?s=await this.getRaw("events",t).buffer(!1).parse(r):"undefined"!=typeof fetch?s=await i(this,t,r):(console.log("WARNING: Browser does not support fetch() required by Pryv.Connection.getEventsStreamed()"),s=await this.getRaw("events",t),s.body.eventsCount=0,s.body.events&&(s.body.events.forEach(e),s.body.eventsCount+=s.body.events.length,delete s.body.events),s.body.eventDeletions&&(s.body.eventDeletions.forEach(e),s.body.eventsCount+=s.body.eventDeletions.length,delete s.body.eventDeletions));const o=Date.now()/1e3;return this._handleMeta(s.body,o),s.body}async createEventWithFile(t,e){const r=await this._post("events").field("event",JSON.stringify(t)).attach("file",e),s=Date.now()/1e3;return this._handleMeta(r.body,s),r.body}async createEventWithFormData(t,e){e.append("event",JSON.stringify(t));return(await this._post("events").send(e)).body}get deltaTime(){return this._deltaTime.value}get apiEndpoint(){return s.buildPryvApiEndpoint(this)}_handleMeta(t,e){if(!t.meta)throw new Error("Cannot find .meta in response.");if(!t.meta.serverTime)throw new Error("Cannot find .meta.serverTime in response.");this._deltaTime.value=(this._deltaTime.value*this._deltaTime.weight+t.meta.serverTime-e)/++this._deltaTime.weight}};const o=r(1)},function(t,e,r){t.exports=r(6)},function(t,e,r){const s=r(7);t.exports=s},function(t,e,r){t.exports={Service:r(1),Connection:r(4),Browser:r(18),utils:r(0),version:r(23).version}},function(t,e,r){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n;"undefined"!=typeof window?n=window:"undefined"==typeof self?(console.warn("Using browser-only version of superagent in non-browser environment"),n=void 0):n=self;var i=r(9),o=r(10),a=r(11),c=r(3),u=r(12),h=r(14);function l(){}t.exports=function(t,r){return"function"==typeof r?new e.Request("GET",t).end(r):1===arguments.length?new e.Request("GET",t):new e.Request(t,r)};var p=e=t.exports;e.Request=w,p.getXHR=function(){if(n.XMLHttpRequest&&(!n.location||"file:"!==n.location.protocol||!n.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw new Error("Browser-only version of superagent could not find XHR")};var d="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function f(t){if(!c(t))return t;var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&y(e,r,t[r]);return e.join("&")}function y(t,e,r){if(void 0!==r)if(null!==r)if(Array.isArray(r))r.forEach((function(r){y(t,e,r)}));else if(c(r))for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&y(t,"".concat(e,"[").concat(s,"]"),r[s]);else t.push(encodeURI(e)+"="+encodeURIComponent(r));else t.push(encodeURI(e))}function m(t){for(var e,r,s={},n=t.split("&"),i=0,o=n.length;i<o;++i)-1===(r=(e=n[i]).indexOf("="))?s[decodeURIComponent(e)]="":s[decodeURIComponent(e.slice(0,r))]=decodeURIComponent(e.slice(r+1));return s}function g(t){return/[/+]json($|[^-\w])/.test(t)}function v(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!==this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.headers=function(t){for(var e,r,s,n,i=t.split(/\r?\n/),o={},a=0,c=i.length;a<c;++a)-1!==(e=(r=i[a]).indexOf(":"))&&(s=r.slice(0,e).toLowerCase(),n=d(r.slice(e+1)),o[s]=n);return o}(this.xhr.getAllResponseHeaders()),this.header=this.headers,this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&t._responseType?this.body=this.xhr.response:this.body="HEAD"===this.req.method?null:this._parseBody(this.text?this.text:this.xhr.response)}function w(t,e){var r=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",(function(){var t,e=null,s=null;try{s=new v(r)}catch(t){return(e=new Error("Parser is unable to parse the response")).parse=!0,e.original=t,r.xhr?(e.rawResponse=void 0===r.xhr.responseType?r.xhr.responseText:r.xhr.response,e.status=r.xhr.status?r.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),r.callback(e)}r.emit("response",s);try{r._isResponseOK(s)||(t=new Error(s.statusText||s.text||"Unsuccessful HTTP response"))}catch(e){t=e}t?(t.original=e,t.response=s,t.status=s.status,r.callback(t,s)):r.callback(null,s)}))}function b(t,e,r){var s=p("DELETE",t);return"function"==typeof e&&(r=e,e=null),e&&s.send(e),r&&s.end(r),s}p.serializeObject=f,p.parseString=m,p.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},p.serialize={"application/x-www-form-urlencoded":f,"application/json":o},p.parse={"application/x-www-form-urlencoded":m,"application/json":JSON.parse},u(v.prototype),v.prototype._parseBody=function(t){var e=p.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&g(this.type)&&(e=p.parse["application/json"]),e&&t&&(t.length>0||t instanceof Object)?e(t):null)},v.prototype.toError=function(){var t=this.req,e=t.method,r=t.url,s="cannot ".concat(e," ").concat(r," (").concat(this.status,")"),n=new Error(s);return n.status=this.status,n.method=e,n.url=r,n},p.Response=v,i(w.prototype),a(w.prototype),w.prototype.type=function(t){return this.set("Content-Type",p.types[t]||t),this},w.prototype.accept=function(t){return this.set("Accept",p.types[t]||t),this},w.prototype.auth=function(t,e,r){1===arguments.length&&(e=""),"object"===s(e)&&null!==e&&(r=e,e=""),r||(r={type:"function"==typeof btoa?"basic":"auto"});var n=function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(t,e,r,n)},w.prototype.query=function(t){return"string"!=typeof t&&(t=f(t)),t&&this._query.push(t),this},w.prototype.attach=function(t,e,r){if(e){if(this._data)throw new Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,r||e.name)}return this},w.prototype._getFormData=function(){return this._formData||(this._formData=new n.FormData),this._formData},w.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var r=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),r(t,e)},w.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},w.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},w.prototype.ca=w.prototype.agent,w.prototype.buffer=w.prototype.ca,w.prototype.write=function(){throw new Error("Streaming is not supported in browser version of superagent")},w.prototype.pipe=w.prototype.write,w.prototype._isHost=function(t){return t&&"object"===s(t)&&!Array.isArray(t)&&"[object Object]"!==Object.prototype.toString.call(t)},w.prototype.end=function(t){this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||l,this._finalizeQueryString(),this._end()},w.prototype._setUploadTimeout=function(){var t=this;this._uploadTimeout&&!this._uploadTimeoutTimer&&(this._uploadTimeoutTimer=setTimeout((function(){t._timeoutError("Upload timeout of ",t._uploadTimeout,"ETIMEDOUT")}),this._uploadTimeout))},w.prototype._end=function(){if(this._aborted)return this.callback(new Error("The request has been aborted even before .end() was called"));var t=this;this.xhr=p.getXHR();var e=this.xhr,r=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var r=e.readyState;if(r>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4===r){var s;try{s=e.status}catch(t){s=0}if(!s){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var s=function(e,r){r.total>0&&(r.percent=r.loaded/r.total*100,100===r.percent&&clearTimeout(t._uploadTimeoutTimer)),r.direction=e,t.emit("progress",r)};if(this.hasListeners("progress"))try{e.addEventListener("progress",s.bind(null,"download")),e.upload&&e.upload.addEventListener("progress",s.bind(null,"upload"))}catch(t){}e.upload&&this._setUploadTimeout();try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(t){return this.callback(t)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!==this.method&&"HEAD"!==this.method&&"string"!=typeof r&&!this._isHost(r)){var n=this._header["content-type"],i=this._serializer||p.serialize[n?n.split(";")[0]:""];!i&&g(n)&&(i=p.serialize["application/json"]),i&&(r=i(r))}for(var o in this.header)null!==this.header[o]&&Object.prototype.hasOwnProperty.call(this.header,o)&&e.setRequestHeader(o,this.header[o]);this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0===r?null:r)},p.agent=function(){return new h},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach((function(t){h.prototype[t.toLowerCase()]=function(e,r){var s=new p.Request(t,e);return this._setDefaults(s),r&&s.end(r),s}})),h.prototype.del=h.prototype.delete,p.get=function(t,e,r){var s=p("GET",t);return"function"==typeof e&&(r=e,e=null),e&&s.query(e),r&&s.end(r),s},p.head=function(t,e,r){var s=p("HEAD",t);return"function"==typeof e&&(r=e,e=null),e&&s.query(e),r&&s.end(r),s},p.options=function(t,e,r){var s=p("OPTIONS",t);return"function"==typeof e&&(r=e,e=null),e&&s.send(e),r&&s.end(r),s},p.del=b,p.delete=b,p.patch=function(t,e,r){var s=p("PATCH",t);return"function"==typeof e&&(r=e,e=null),e&&s.send(e),r&&s.end(r),s},p.post=function(t,e,r){var s=p("POST",t);return"function"==typeof e&&(r=e,e=null),e&&s.send(e),r&&s.end(r),s},p.put=function(t,e,r){var s=p("PUT",t);return"function"==typeof e&&(r=e,e=null),e&&s.send(e),r&&s.end(r),s}},function(t,e,r){function s(t){if(t)return function(t){for(var e in s.prototype)t[e]=s.prototype[e];return t}(t)}t.exports=s,s.prototype.on=s.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},s.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},s.prototype.off=s.prototype.removeListener=s.prototype.removeAllListeners=s.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,s=this._callbacks["$"+t];if(!s)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n=0;n<s.length;n++)if((r=s[n])===e||r.fn===e){s.splice(n,1);break}return 0===s.length&&delete this._callbacks["$"+t],this},s.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),r=this._callbacks["$"+t],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(r){s=0;for(var n=(r=r.slice(0)).length;s<n;++s)r[s].apply(this,e)}return this},s.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},s.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e){t.exports=n,n.default=n,n.stable=o,n.stableStringify=o;var r=[],s=[];function n(t,e,n){var i;for(!function t(e,n,i,o){var a;if("object"==typeof e&&null!==e){for(a=0;a<i.length;a++)if(i[a]===e){var c=Object.getOwnPropertyDescriptor(o,n);return void(void 0!==c.get?c.configurable?(Object.defineProperty(o,n,{value:"[Circular]"}),r.push([o,n,e,c])):s.push([e,n]):(o[n]="[Circular]",r.push([o,n,e])))}if(i.push(e),Array.isArray(e))for(a=0;a<e.length;a++)t(e[a],a,i,e);else{var u=Object.keys(e);for(a=0;a<u.length;a++){var h=u[a];t(e[h],h,i,e)}}i.pop()}}(t,"",[],void 0),i=0===s.length?JSON.stringify(t,e,n):JSON.stringify(t,a(e),n);0!==r.length;){var o=r.pop();4===o.length?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}return i}function i(t,e){return t<e?-1:t>e?1:0}function o(t,e,n){var o,c=function t(e,n,o,a){var c;if("object"==typeof e&&null!==e){for(c=0;c<o.length;c++)if(o[c]===e){var u=Object.getOwnPropertyDescriptor(a,n);return void(void 0!==u.get?u.configurable?(Object.defineProperty(a,n,{value:"[Circular]"}),r.push([a,n,e,u])):s.push([e,n]):(a[n]="[Circular]",r.push([a,n,e])))}if("function"==typeof e.toJSON)return;if(o.push(e),Array.isArray(e))for(c=0;c<e.length;c++)t(e[c],c,o,e);else{var h={},l=Object.keys(e).sort(i);for(c=0;c<l.length;c++){var p=l[c];t(e[p],p,o,e),h[p]=e[p]}if(void 0===a)return h;r.push([a,n,e]),a[n]=h}o.pop()}}(t,"",[],void 0)||t;for(o=0===s.length?JSON.stringify(c,e,n):JSON.stringify(c,a(e),n);0!==r.length;){var u=r.pop();4===u.length?Object.defineProperty(u[0],u[1],u[3]):u[0][u[1]]=u[2]}return o}function a(t){return t=void 0!==t?t:function(t,e){return e},function(e,r){if(s.length>0)for(var n=0;n<s.length;n++){var i=s[n];if(i[1]===e&&i[0]===r){r="[Circular]",s.splice(n,1);break}}return t.call(this,e,r)}}},function(t,e,r){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n=r(3);function i(t){if(t)return function(t){for(var e in i.prototype)Object.prototype.hasOwnProperty.call(i.prototype,e)&&(t[e]=i.prototype[e]);return t}(t)}t.exports=i,i.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),clearTimeout(this._uploadTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,delete this._uploadTimeoutTimer,this},i.prototype.parse=function(t){return this._parser=t,this},i.prototype.responseType=function(t){return this._responseType=t,this},i.prototype.serialize=function(t){return this._serializer=t,this},i.prototype.timeout=function(t){if(!t||"object"!==s(t))return this._timeout=t,this._responseTimeout=0,this._uploadTimeout=0,this;for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;case"upload":this._uploadTimeout=t.upload;break;default:console.warn("Unknown timeout option",e)}return this},i.prototype.retry=function(t,e){return 0!==arguments.length&&!0!==t||(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var o=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];i.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(t,e);if(!0===r)return!0;if(!1===r)return!1}catch(t){console.error(t)}if(e&&e.status&&e.status>=500&&501!==e.status)return!0;if(t){if(t.code&&o.includes(t.code))return!0;if(t.timeout&&"ECONNABORTED"===t.code)return!0;if(t.crossDomain)return!0}return!1},i.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this.timedoutError=null,this._end()},i.prototype.then=function(t,e){var r=this;if(!this._fullfilledPromise){var s=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise((function(t,e){s.on("abort",(function(){if(!(r._maxRetries&&r._maxRetries>r._retries))if(r.timedout&&r.timedoutError)e(r.timedoutError);else{var t=new Error("Aborted");t.code="ABORTED",t.status=r.status,t.method=r.method,t.url=r.url,e(t)}})),s.end((function(r,s){r?e(r):t(s)}))}))}return this._fullfilledPromise.then(t,e)},i.prototype.catch=function(t){return this.then(void 0,t)},i.prototype.use=function(t){return t(this),this},i.prototype.ok=function(t){if("function"!=typeof t)throw new Error("Callback required");return this._okCallback=t,this},i.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},i.prototype.get=function(t){return this._header[t.toLowerCase()]},i.prototype.getHeader=i.prototype.get,i.prototype.set=function(t,e){if(n(t)){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&this.set(r,t[r]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},i.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},i.prototype.field=function(t,e){if(null==t)throw new Error(".field(name, val) name can not be empty");if(this._data)throw new Error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()");if(n(t)){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&this.field(r,t[r]);return this}if(Array.isArray(e)){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&this.field(t,e[s]);return this}if(null==e)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof e&&(e=String(e)),this._getFormData().append(t,e),this},i.prototype.abort=function(){return this._aborted||(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort")),this},i.prototype._auth=function(t,e,r,s){switch(r.type){case"basic":this.set("Authorization","Basic ".concat(s("".concat(t,":").concat(e))));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer ".concat(t))}return this},i.prototype.withCredentials=function(t){return void 0===t&&(t=!0),this._withCredentials=t,this},i.prototype.redirects=function(t){return this._maxRedirects=t,this},i.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw new TypeError("Invalid argument");return this._maxResponseSize=t,this},i.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},i.prototype.send=function(t){var e=n(t),r=this._header["content-type"];if(this._formData)throw new Error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()");if(e&&!this._data)Array.isArray(t)?this._data=[]:this._isHost(t)||(this._data={});else if(t&&this._data&&this._isHost(this._data))throw new Error("Can't merge these send calls");if(e&&n(this._data))for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(this._data[s]=t[s]);else"string"==typeof t?(r||this.type("form"),r=this._header["content-type"],this._data="application/x-www-form-urlencoded"===r?this._data?"".concat(this._data,"&").concat(t):t:(this._data||"")+t):this._data=t;return!e||this._isHost(t)||r||this.type("json"),this},i.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},i.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.includes("?")?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var r=this.url.slice(e+1).split("&");"function"==typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.slice(0,e)+"?"+r.join("&")}}},i.prototype._appendQueryString=function(){console.warn("Unsupported")},i.prototype._timeoutError=function(t,e,r){if(!this._aborted){var s=new Error("".concat(t+e,"ms exceeded"));s.timeout=e,s.code="ECONNABORTED",s.errno=r,this.timedout=!0,this.timedoutError=s,this.abort(),this.callback(s)}},i.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout((function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")}),this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout((function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")}),this._responseTimeout))}},function(t,e,r){"use strict";var s=r(13);function n(t){if(t)return function(t){for(var e in n.prototype)Object.prototype.hasOwnProperty.call(n.prototype,e)&&(t[e]=n.prototype[e]);return t}(t)}t.exports=n,n.prototype.get=function(t){return this.header[t.toLowerCase()]},n.prototype._setHeaderProperties=function(t){var e=t["content-type"]||"";this.type=s.type(e);var r=s.params(e);for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(this[n]=r[n]);this.links={};try{t.link&&(this.links=s.parseLinks(t.link))}catch(t){}},n.prototype._setStatusProperties=function(t){var e=t/100|0;this.statusCode=t,this.status=this.statusCode,this.statusType=e,this.info=1===e,this.ok=2===e,this.redirect=3===e,this.clientError=4===e,this.serverError=5===e,this.error=(4===e||5===e)&&this.toError(),this.created=201===t,this.accepted=202===t,this.noContent=204===t,this.badRequest=400===t,this.unauthorized=401===t,this.notAcceptable=406===t,this.forbidden=403===t,this.notFound=404===t,this.unprocessableEntity=422===t}},function(t,e,r){"use strict";e.type=function(t){return t.split(/ *; */).shift()},e.params=function(t){return t.split(/ *; */).reduce((function(t,e){var r=e.split(/ *= */),s=r.shift(),n=r.shift();return s&&n&&(t[s]=n),t}),{})},e.parseLinks=function(t){return t.split(/ *, */).reduce((function(t,e){var r=e.split(/ *; */),s=r[0].slice(1,-1);return t[r[1].split(/ *= */)[1].slice(1,-1)]=s,t}),{})},e.cleanHeader=function(t,e){return delete t["content-type"],delete t["content-length"],delete t["transfer-encoding"],delete t.host,e&&(delete t.authorization,delete t.cookie),t}},function(t,e,r){"use strict";function s(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,s=new Array(e);r<e;r++)s[r]=t[r];return s}function i(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert","disableTLSCerts"].forEach((function(t){i.prototype[t]=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];return this._defaults.push({fn:t,args:r}),this}})),i.prototype._setDefaults=function(t){this._defaults.forEach((function(e){t[e.fn].apply(t,s(e.args))}))},t.exports=i},function(t,e,r){const s=r(0);class n{constructor(t,e){this._assets=t,this._assetsURL=e}static async setup(t){const e=await s.superagent.get(t).set("accept","json");return new n(e.body,t)}get(t){let e=Object.assign({},this._assets);return t&&t.split(":").forEach(t=>{if(e=e[t],void 0===e)return e}),e}getUrl(t){const e=this.get(t);if("string"!=typeof e)throw new Error(e+" returned "+value);return this.relativeURL(e)}relativeURL(t){return function(t,e){var r=location;t&&((r=document.createElement("a")).href=t);for(var s,n,i="",o=r.pathname.replace(/[^\/]*$/,e.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),a=0;(n=o.indexOf("/../",a))>-1;a=n+s)s=/^\/(?:\.\.\/)*/.exec(o.slice(n))[0].length,i=(i+o.substring(a,n)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(s-1)/3+"}$"),"/");let c=r.port?":"+r.port:"";return r.protocol+"//"+r.hostname+c+i+o.substr(a)}(this._assets.baseUrl||this._assetsURL,t)}async setAllDefaults(){this.setFavicon(),await this.loadCSS()}setFavicon(){var t=document.querySelector("link[rel*='icon']")||document.createElement("link");t.type="image/x-icon",t.rel="shortcut icon",t.href=this.relativeURL(this._assets.favicon.default.url),document.getElementsByTagName("head")[0].appendChild(t)}async loadCSS(){i(this.relativeURL(this._assets.css.default.url))}async loginButtonLoadCSS(){i(this.relativeURL(this._assets["lib-js"].buttonSignIn.css))}async loginButtonGetHTML(){return(await s.superagent.get(this.relativeURL(this._assets["lib-js"].buttonSignIn.html)).set("accept","html")).text}async loginButtonGetMessages(){return(await s.superagent.get(this.relativeURL(this._assets["lib-js"].buttonSignIn.messages)).set("accept","json")).body}}function i(t){var e=document.getElementsByTagName("head")[0],r=document.createElement("link");r.id=t,r.rel="stylesheet",r.type="text/css",r.href=t,r.media="all",e.appendChild(r)}t.exports=n},function(t,e){const r=['"events":[','"eventDeletions":['];t.exports=function(t,e){let s=0,n="",i=null,o=0,a=!1,c=!1,u=0,h=0,l=0;const p=0,d=1,f=2;let y=p;function m(){switch(y){case p:(t=n.indexOf(r[s]))>0&&(0===s&&(i=n.substring(0,t)),n=n.substr(t+r[s].length),y=d,g());break;case d:g();break;default:i+=n,n=""}var t}function g(){for(;u<n.length&&y===d;)if(c)c=!1,u++;else{switch(n.charCodeAt(u)){case 93:if(0===o){if(0!==u)throw new Error("Found trailling ] in mid-course");if(0===s&&e)return y=p,void(s=1);{y=f;let t="";1===s&&(t='"eventDeletionsCount":'+l+","),n=t+'"eventsCount":'+h+n.substr(1)}}break;case 92:c=!0;break;case 123:a||o++;break;case 34:a=!a;break;case 125:if(a||o--,0===o){const e=44===n.charCodeAt(0)?1:0,i=n.substring(e,u+1);0===s?h++:l++,n=n.substr(u+1),r=i,t(JSON.parse(r)),u=-1}}u++}var r}return function(t,e){t.setEncoding("utf8"),t.on("data",t=>{n+=t,m()}),t.on("end",()=>{let r,s;try{t.text=i+n,s=t.text&&JSON.parse(t.text)}catch(e){r=e,r.rawResponse=t.text||null,r.statusCode=t.statusCode}finally{e(r,s)}})}}},function(t,e){t.exports=async function(t,e,r){const s={ondata:null,onend:null,encoding:"utf8"},n={setEncoding:function(t){s.encoding=t},on:function(t,e){s["on"+t]=e}};let i,o;r(n,(function(t,e){i=t,o=e}));let a=new URL(t.endpoint+"events");a.search=new URLSearchParams(e);let c={method:"GET",headers:{Accept:"application/jon"}};t.token&&(c.headers.Authorization=t.token);let u=await fetch(a,c);const h=u.body.getReader();for(;;){const{done:t,value:e}=await h.read();if(s.ondata(new TextDecoder(s.encoding).decode(e)),t){s.onend();break}}if(i)throw new Error(i);const l={text:n.text,body:o,statusCode:u.status,headers:{}};for(var p of u.headers.entries())l.headers[p[0]]=p[1];return l}},function(t,e,r){const s=r(19),n=r(2);t.exports={setupAuth:async function(t,e,r){return new s(t,e,r).init()},AuthStates:n,serviceInfoFromUrl:s.getServiceInfoFromURL}},function(t,e,r){const s=r(0),n=r(1),i=r(20),o=r(2),a=r(22),c=/[?#&]+([^=&]+)=([^&]*)/g,u=/[?#&]+prYv([^=&]+)=([^&]*)/g;class h{constructor(t,e,r){if(this.stateChangeListners=[],this.settings=t,this.serviceInfoUrl=e,this.serviceCustomizations=r,!t)throw new Error("settings cannot be null");this.settings.spanButtonID?(this.loginButton=new i(this),this.stateChangeListners.push(this.loginButton.onStateChange.bind(this.loginButton))):document&&console.log("WARNING: Pryv.Browser initialized with no spanButtonID");try{if(!this.settings.onStateChange)throw new Error("Missing settings.onStateChange");if(this.stateChangeListners.push(this.settings.onStateChange),!this.settings.authRequest)throw new Error("Missing settings.authRequest");if(this.settings.authRequest.returnURL=h.getReturnURL(this.settings.authRequest.returnURL),!this.settings.authRequest.requestingAppId)throw new Error("Missing settings.authRequest.requestingAppId");if(this.cookieKey="pryv-libjs-"+this.settings.authRequest.requestingAppId,!this.settings.authRequest.requestedPermissions)throw new Error("Missing settings.authRequest.requestedPermissions");this.serviceInfoUrl}catch(t){throw this.state={id:o.ERROR,message:"During initialization",error:t},t}}async init(){if(this.state={id:o.LOADING},this.pryvService)throw new Error("Browser service already initialized");this.pryvService=new n(this.serviceInfoUrl,this.serviceCustomizations);try{this.pryvServiceInfo=await this.pryvService.info()}catch(t){throw this.state={id:o.ERROR,message:"Cannot fetch service/info",error:t},t}if(this.loginButton)try{await this.loginButton.loadAssets(this.pryvService)}catch(t){throw this.state={id:o.ERROR,message:"Cannot fetch button visuals",error:t},t}const t=h.getQueryParamsFromURL();if(t.prYvkey){try{const e=await s.superagent.get(this.pryvServiceInfo.access+t.prYvkey);this.processAccess(e.body)}catch(t){this.state={id:o.ERROR,message:"Cannot fetch result",error:t}}return this.pryvService}let e=null;try{e=a.get(this.cookieKey)}catch(t){console.log(t)}return e?this.state={id:o.AUTHORIZED,apiEndpoint:e.apiEndpoint,displayName:e.displayName,action:this.logOut}:this.readyAndClean(),this.pryvService}readyAndClean(){a.del(this.cookieKey),this.accessData=null,this.state={id:o.INITIALIZED,serviceInfo:this.serviceInfo,action:this.openLoginPage}}async postAccess(){try{return(await s.superagent.post(this.pryvServiceInfo.access).set("accept","json").send(this.settings.authRequest)).body}catch(t){throw this.state={id:o.ERROR,message:"Requesting access",error:t},t}}async getAccess(){return(await s.superagent.get(this.accessData.poll).set("accept","json")).body}async poll(){"NEED_SIGNIN"===this.accessData.status?this.settings.authRequest.returnURL||(this.polling=!0,this.processAccess(await this.getAccess()),setTimeout(this.poll.bind(this),this.accessData.poll_rate_ms)):this.polling=!1}processAccess(t){if(!t||!t.status)throw this.state={id:o.ERROR,message:"Invalid Access data response",error:new Error("Invalid Access data response")},this.state.error;switch(this.accessData=t,this.accessData.status){case"ERROR":this.state={id:o.ERROR,message:"Error on the backend"};break;case"ACCEPTED":const t=n.buildAPIEndpoint(this.pryvServiceInfo,this.accessData.username,this.accessData.token);a.set(this.cookieKey,{apiEndpoint:t,displayName:this.accessData.username}),this.state={id:o.AUTHORIZED,apiEndpoint:t,displayName:this.accessData.username,action:this.logOut}}}set state(t){this._state=t,this.stateChangeListners.map(t=>{try{t(this.state)}catch(t){console.log(t)}})}get state(){return this._state}async openLoginPage(){if(console.log("OpenLogin",this),!this.pryvServiceInfo)throw new Error("Browser service must be initialized first");this.accessData||this.processAccess(await this.postAccess()),"NEED_SIGNIN"===this.accessData.status&&this.popupLogin(),this.polling||this.poll()}logOut(){const t=this.loginButton?this.loginButton.myMessages.LOGOUT_CONFIRM:"Logout ?";confirm(t)&&this.readyAndClean()}popupLogin(){if(!this.accessData||!this.accessData.url)throw new Error("Pryv Sign-In Error: NO SETUP. Please call Browser.setupAuth() first.");if(this.settings.authRequest.returnURL)return void(location.href=this.accessData.url);var t=void 0!==window.screenX?window.screenX:window.screenLeft,e=void 0!==window.screenY?window.screenY:window.screenTop,r=void 0!==window.outerWidth?window.outerWidth:document.body.clientWidth,s=void 0!==window.outerHeight?window.outerHeight:document.body.clientHeight-22,n="width=270,height=420,left="+parseInt(t+(r-270)/2,10)+",top="+parseInt(e+(s-420)/2.5,10)+",scrollbars=yes";const i=this.accessData.authUrl||this.accessData.url;this.popup=window.open(i,"prYv Sign-in",n),this.popup?window.focus&&this.popup.focus():console.log("FAILED_TO_OPEN_WINDOW")}static getReturnURL(t,e,r){let s=t||"auto#";const n=e||window.location.href;var i=s.slice(-1);if("#&?".indexOf(i)<0)throw new Error('Pryv access: Last character of --returnURL setting-- is not "?", "&" or "#": '+s);return!(0===s.indexOf("auto")&&!h.browserIsMobileOrTablet(r))&&((0===s.indexOf("auto")&&h.browserIsMobileOrTablet(r)||0===s.indexOf("self"))&&(s=n+s.substring(4)),h.cleanURLFromPrYvParams(s))}static browserIsMobileOrTablet(t){const e=t||navigator;var r,s=!1;return r=e.userAgent||e.vendor||e.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4)))&&(s=!0),s}static getQueryParamsFromURL(t){t=t||window.location.href;var e={};return t.replace(c,(function(t,r,s){e[r]=decodeURIComponent(s)})),e}static getServiceInfoFromURL(t){return h.getQueryParamsFromURL(t)[h.options.SERVICE_INFO_QUERY_PARAM_KEY]}static getStatusFromURL(t){return h.getQueryParamsFromURL(t).prYvstatus}static cleanURLFromPrYvParams(t){return t.replace(u,"")}}h.options={SERVICE_INFO_QUERY_PARAM_KEY:"pryvServiceInfoUrl"},t.exports=h},function(t,e,r){const s=r(21),n=r(2);t.exports=class{constructor(t){if(this.languageCode=t.settings.authRequest.languageCode||"en",this.myMessages=s(this.languageCode),this.loginButtonSpan=document.getElementById(t.settings.spanButtonID),!this.loginButtonSpan)throw new Error("No Cannot find SpanId: "+t.settings.spanButtonID+" in DOM");this.loginButtonText=this.loginButtonSpan,this.loginButtonSpan.addEventListener("click",this.onClick.bind(this)),this.auth=t,this.onStateChange({id:n.LOADING})}async loadAssets(t){const e=await t.assets();e.loginButtonLoadCSS(),this.loginButtonSpan.innerHTML=await e.loginButtonGetHTML(),this.loginButtonText=document.getElementById("pryv-access-btn-text");const r=await e.loginButtonGetMessages();r.LOADING?this.myMessages=s(this.languageCode,r):console.log("WARNING Messages cannot be loaded using defaults: ",r),this.onStateChange(),this.refreshText()}refreshText(){this.loginButtonText&&(this.loginButtonText.innerHTML=this.text)}onClick(){this.auth.state.action&&this.auth.state.action.apply(this.auth)}onStateChange(t){switch(t&&(this.lastState=t),this.lastState.id){case n.ERROR:this.text=this.myMessages.ERROR+": "+this.lastState.message;break;case n.LOADING:this.text=this.myMessages.LOADING;break;case n.INITIALIZED:this.text=this.myMessages.LOGIN+": "+this.auth.pryvServiceInfo.name;break;case n.AUTHORIZED:this.text=this.lastState.displayName;break;default:console.log("WARNING Unhandled state for Login: "+this.lastState.id)}this.refreshText()}}},function(t,e){const r={LOADING:{en:"..."},ERROR:{en:"Error",fr:"Erreur"},LOGIN:{en:"Signin",fr:"Login"},LOGOUT_CONFIRM:{en:"Logout ?",fr:"Se deconnecter ?"}};t.exports=function(t,e){const s=e||r,n={};return Object.keys(s).map(e=>{n[e]=s[e][t]||s[e].en}),n}},function(t,e,r){const s=r(0);function n(t,e,r){if(s.isBrowser()){r=r||365;var n=new Date,i=window.location.hostname,o=window.location.pathname;n.setDate(n.getDate()+r);var a=encodeURIComponent(t)+"="+encodeURIComponent(JSON.stringify(e))+";expires="+n.toGMTString()+";domain=."+i+";path="+o;r>=0&&(a+=";SameSite=Strict"),document.cookie=a}}e.set=n,e.get=function(t){const e=encodeURIComponent(t);if(s.isBrowser()){var r=("; "+document.cookie).split("; "+e+"=");return 2==r.length?JSON.parse(decodeURIComponent(r.pop().split(";").shift())):void 0}},e.del=function(t){n(t,{deleted:!0},-1)}},function(t){t.exports=JSON.parse('{"name":"pryv","version":"2.0.3","homepage":"https://github.com/pryv/lib-js","description":"Pryv Javascript Library","keywords":["Pryv"],"repository":{"type":"git","url":"git://github.com/pryv/lib-js"},"bugs":{"url":"https://github.com/pryv/lib-js/issues"},"author":{"name":"Pryv S.A."},"main":"src/index.js","license":"BSD-3-Clause","scripts":{"setup":"./scripts/setup-environment-dev.sh","build":"webpack --config webpack.config.js","doc":"node node_modules/jsdoc/jsdoc.js -c .jsdoc-conf.json","test":"mocha --reporter spec  test/**/*.test.js","test-debug":"mocha --inpect-brk=40000 --reporter spec  test/**/*.test.js ","test:browser":"npm run build; ","cover":"nyc npm run test && npm run cover:report","cover:report":"nyc report --reporter=lcov --reporter=html","webserver":"node node_modules/rec-la/webserver/main.js ./dist 9443","gh-pages":"./scripts/upload.sh","clear":"rm -r dist/ && npm run setup"},"contributors":[{"name":"Pierre-Mikael Legris","email":"perki@pryv.com"}],"dependencies":{"superagent":"^5.2.2"},"devDependencies":{"@pryv/lib-js-common":"git+https://github.com/pryv/lib-js-common.git","@pryv/monitor":"^1.0.0","@pryv/socket.io":"^1.0.1","chai":"^4.2.0","chai-as-promised":"^7.1.1","cuid":"^2.1.8","jsdoc":"^3.6.4","mocha":"^6.2.3","node-fetch":"^2.6.0","nyc":"^14.1.1","rec-la":"^0.1.13","universal-url":"^2.0.0","zombie":"^6.1.4"}}')}]);
//# sourceMappingURL=pryv-es6.js.map